以下、これまでの内容を **TODO Webアプリ画面設計書** として整理します。

---

## 更新履歴（サマリ）
- 2025-12-16: コマンドバーを1行化（ロゴ＋検索＋ステータスフィルタ）、ソートボタン削除。フォームの文字色／プレースホルダ色を全体統一。
- 2025-12-16: ステータスに「待ち」「保留」を追加。ステータス更新中表示を行内固定幅にしレイアウト崩れを防止。
- 2025-12-16: タグ編集をチップ＋検索可能プルダウン化。クリック/Enter/Spaceで即表示、部分一致フィルタ、未一致Enterで新規作成、選択しても閉じず連続追加可。
- 2025-12-16: キーボード操作強化  
  - フォーカス移動: `j/k`、範囲拡大: `Shift+j/k`（フォーカス範囲をハイライト、選択状態は変えない）  
  - 並び替え: `Alt+↑/↓`、`Ctrl+J/K`（フォーカス範囲・複数選択ブロックをまとめて移動）、ドラッグ&DROP  
  - リストへ: `L`、ステータス巡回: `S`、検索: `/`
- 2025-12-16: 並び替えで `updatedAt` を更新せず手動順を保持。ソートはテーブルヘッダークリックのみ。

---

# 1. 画面概要

## 1-1. 画面名

* TODO一覧・編集画面

## 1-2. 目的

* 1画面上で以下を完結させる：

  * タスクの作成・編集・削除
  * タスク検索・フィルタ・並び替え
  * タスク一覧の閲覧
  * 複数選択による一括削除
* スクロール量を減らし、できるだけ多くのタスクを同時表示する
* キーボード操作中心でも軽快に扱えるUI

## 1-3. 対象

* 個人向けWebアプリ（PCブラウザ想定）
* タスク数：最大100件程度を想定

---

# 2. 画面レイアウト構成

```text
┌───────────────────────────────────────────────────────────────┐
│ [ヘッダー・コマンドバー]                                       │
├───────────────────────────────────────────────────────────────┤
│ [クイック追加行]                                             │
├───────────────────────────────────────────────────────────────┤
│ [バルク操作バー（選択時のみ表示）]                           │
├───────────────────────────────────────────────────────────────┤
│ [タスク一覧テーブル（中央ペイン）]                          │
└───────────────────────────────────────────────────────────────┘
                          ┌─────────────────────────────┐
                          │ [詳細ペイン（右インスペクタ）] │
                          └─────────────────────────────┘
```

## 2-1. ヘッダー・コマンドバー（画面上部、固定）

**配置要素**

* 左：アプリ名 / ロゴ（例：`TODO`）
* 中央：検索ボックス（プレースホルダ：`/ 検索…`、`/` でフォーカス）
* 右：状態フィルタ（TODO / DOING / WAITING / PENDING / DONE）

**挙動**

* 常に画面上部に固定（スクロールしても表示）
* 1行レイアウトで高さを抑制。ソートボタンは廃止し、並べ替えはテーブルヘッダークリックで行う。

---

## 2-2. クイック追加行

**位置**

* ヘッダー直下に1行表示

**要素**

* 「+ 新規」ボタン（ラベル：`+ 新規`）
* タイトル入力フィールド（単一行テキスト）
* タグ入力フィールド（任意）
* 期限入力（任意、日付）
* ステータス初期値（TODO固定 or プルダウン）
* Enterで追加

**プレースホルダ例**

* タイトル：`タイトル…`
* タグ：`#tag…`
* 期限：`期限…`

**操作**

* `N` キー押下でタイトルフィールドにフォーカス
* Enterでタスク作成 → テーブル先頭に追加

---

## 2-3. バルク操作バー（複数選択時のみ）

**位置**

* クイック追加行の下、タスク一覧テーブルの上

**表示条件**

* 1件以上タスクが選択されているときのみ表示

**内容**

* 左側：`X件選択中` 表示
* 右側：

  * `[削除 Del]` ボタン
  * `[選択解除 Esc]` ボタン

**挙動**

* `Del` キー、または「削除」クリックで選択タスクを削除
* 削除後はトーストでUndo案内

---

## 2-4. タスク一覧テーブル（中央ペイン）

**目的**

* 可能な限り多くのタスクを一覧表示
* 行あたりの情報を最小限にしながら必要情報は保持

### 2-4-1. 行レイアウト

**行高さ**

* 約 30px（高密度）

**列構成（左→右）**

1. **選択チェックボックス**

   * 幅：約32px
   * ヘッダー行：三状態チェックボックス（全選択 / 全解除 / 一部選択）
2. **タイトル**

   * 幅：残りスペースに対してflex
   * 表示：1行、末尾は `…` で省略
   * ホバー時：ツールチップでフル表示（タイトル＆説明プレビューも可）
   * DONEタスクなどは淡色表示で区別
3. **ステータス**

   * 幅：約92px
   * 表示値：`TODO / DOING / WAITING / PENDING / DONE`
   * 小さなバッジ（ピル型）で色分け
4. **期限**

   * 幅：約84px
   * 表示形式：`MM/DD`
   * 期限未設定：`—`
   * 期限切れ：文字色を強調
5. **タグ**

   * 幅：約180px
   * 選択済みタグをチップ表示（×で削除可）
   * フィールドクリック/Enter/Spaceで検索可能プルダウンを開く
   * 入力で部分一致フィルタ、未一致時は Enter で新規タグ作成しチップ追加
   * 既存タグを選択してもプルダウンを閉じず連続追加できる
6. **更新日時（相対表示）**

   * 幅：約72px
   * 表示形式：`2h` / `1d` / `3d` など相対時間
   * 正確な日時は詳細ペインに表示

**補足**

* 作成日時 / 正確な更新日時はテーブルには表示しない
* 説明は一覧では非表示（ホバーや詳細ペインで確認）

### 2-4-2. テーブル全体の挙動

* ヘッダー行はスクロール時も固定
* 行ホバー：背景色を薄く変える
* 行選択：クリック／チェックボックス。`Shift`で範囲、`Ctrl/Cmd`で多重
* 並び替え：ヘッダークリックで昇順/降順切替（更新/期限/タイトル/ステータス/手動順）
* 手動順（order）は並び替えの基準として保持し、更新日時更新による順位変動を防ぐ

---

## 2-5. 詳細ペイン（右インスペクタ）

* 右側に縦配置、幅はドラッグで調整（例：最小 280px ～ 最大 40%）
* 行選択時に表示（常時表示でも可）。`Enter` で開閉トグル
* 表示項目：タイトル、ステータス、期限、タグ（複数編集）、説明、作成日時、更新日時、削除ボタン
* 保存：自動保存が推奨（一定時間停止で保存、Undo対応）

---

# 3. データ項目定義

## 3-1. タスク項目

| 項目名   | 説明                              | 入力/表示場所           |
| ----- | ------------------------------- | ----------------- |
| タイトル  | タスク名                            | クイック追加・詳細・一覧      |
| 説明    | タスク詳細説明                         | 詳細ペイン             |
| ステータス | TODO/DOING/WAITING/PENDING/DONE | クイック追加(初期)、詳細、一覧  |
| 期限    | 締め切り日                           | クイック追加、詳細、一覧      |
| タグ    | 任意タグ（複数）                        | クイック追加、詳細、一覧      |
| 作成日時  | タスク作成時刻                         | 詳細ペインのみ           |
| 更新日時  | 最終更新時刻                          | 詳細ペイン（正確値）、一覧（相対） |

## 3-2. ステータス仕様

* 値：`TODO / DOING / WAITING / PENDING / DONE`
* 表示：ステータスバッジ（色分け）
* フィルタ：ヘッダーのステータスフィルタで複数選択可能

---

# 4. 操作仕様

## 4-1. キーボード操作（主要）

| 操作                    | キー例                                         |
| ----------------------- | ---------------------------------------------- |
| 検索へフォーカス            | `/`                                            |
| リストへフォーカス          | `L`                                            |
| フォーカス移動              | `j / k`（または ↑ / ↓）                         |
| フォーカス範囲拡大          | `Shift + j/k`（選択状態は変えずハイライト範囲を拡大） |
| 並び替え                  | `Alt + ↑/↓`、`Ctrl + J/K`（複数範囲も移動）      |
| ステータス巡回              | `S`                                            |
| 新規タスク（クイック追加へ）     | `N`                                            |
| 検索テキスト確定            | `Enter`（検索フィールド内）                       |
| 削除                     | `Del`                                          |
| 選択解除                  | `Esc`                                          |

## 4-2. マウス操作（抜粋）

| 操作         | 方法                                  |
| ---------- | ------------------------------------- |
| タスク選択      | 行をクリック、チェックボックスで複数選択          |
| 並び替え       | 列ヘッダークリック or 行のドラッグ&ドロップ       |
| タグ編集       | タグフィールドをクリック → ドロップダウンで選択/追加 |
| 詳細表示       | 行選択で右ペイン表示（またはダブルクリック）         |
| ペイン幅変更     | 右ペイン境界をドラッグ                         |

---

# 5. 検索・フィルタ・ソート仕様

* 検索：タイトル / 説明 / タグに対する部分一致。`/` でフォーカス。
* ステータスフィルタ：複数選択可（TODO/DOING/WAITING/PENDING/DONE）。
* ソート：テーブルヘッダークリック（更新・期限・タイトル・ステータス・手動順）。手動順は order を保持し、更新日時変更で位置が跳ねない。

---

# 6. 見た目・UIポリシー

* シンプルで軽快、淡色をベース。DONE は淡色表示。
* プレースホルダ色：`--color-text-muted`、入力色：`--color-text` に統一。
* 行の高さ・余白を抑え、表示行数を優先。

---

