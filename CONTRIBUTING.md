# コントリビューションガイド

迅速かつ安全に改善を届けるために、ご協力ありがとうございます。本ガイドは `AGENTS.md` に記載された開発ルールを実務向けに要約したもので、プルリクエストを作成する前に必ず目を通してください。

## はじめに
- 外部コントリビュータはフォークして作業し、内部メンバーはリポジトリ直下で短命ブランチ（1〜3日）を切ってください。
- `main` を頻繁に同期してください。`git fetch origin && git rebase origin/main` で線形履歴を保つことを推奨します。

## ブランチ命名規約
すべて小文字・ハイフン区切りで、以下のパターンに従ってブランチを作成します。
- 機能: `feature/{issue-number}-{short-desc}`
- バグ修正: `fix/{issue-number}-{short-desc}`
- 雑務: `chore/{short-desc}`
- 緊急修正: `hotfix/{short-desc}`
- リリース: `release/{YYYY-MM-DD}` または `release/{version}`

## Conventional Commits
すべてのコミットは [Conventional Commits](https://www.conventionalcommits.org/) 仕様に従ってください。レビューの助けになる範囲でスコープを付けましょう。
- `feat(web): add quick filter shortcuts`
- `fix(api): normalize tag ids`
- `chore(deps): bump playwright`

破壊的変更がある場合は、型の後に `!` を付ける（例: `feat!:`）か、本文に `BREAKING CHANGE:` フッターを追記します。CI が規約違反のコミットを含む PR を拒否します。

## プルリクエスト
1. 作業開始時にドラフト PR を作成し、ローカルで lint/test/build が通った段階でレビュー依頼に切り替えます。
2. テンプレートの各セクションを必ず埋めてください。
   - 目的・背景
   - 変更点
   - 動作確認（必要に応じてスクリーンショットやログ）
   - 実行した自動テスト
   - リスクとロールバック手順
   - Issue との紐付け（`Fixes #123` など）
3. 差分は小さく（目安 400 LOC 以下）保ち、大きくなる場合は作業を分割してください。
4. ブランチを `main` の最新に追従させ、CI（lint/test/build/e2e）がすべて緑であることを確認してからレビューを依頼します。
5. レビュー承認は最低 1 名必要です。Squash Merge のみ許可され、最終コミットメッセージは PR タイトルになります。

## テストに関する期待値
- プッシュ前に `npm run lint`、`npm run build`、`npm test` を実行してください。
- UI フローを変更した場合は、可能な範囲で Storybook ストーリーや Playwright テストを追加・更新します。
- リファクタリング前に回帰テストを追加してください。レガシー領域では、まず特性テストで既存挙動を固定することを推奨します。

## セキュリティとシークレット
- 認証情報・トークン・個人情報をコミットしないでください。GitHub Actions Secrets や環境ごとのキーバンクを利用します。
- 万一シークレットが漏えいした場合は、即座にローテーションし、テックリードへ連絡して履歴の洗浄を依頼してください。

## コードレビューのマナー
- 任意対応や大規模リファクタはフォローアップ Issue を作成し、現在の PR は焦点を絞りましょう。
- 良い実装には前向きなフィードバックを添え、お互いの成果を称え合いましょう。

## ライセンス
本リポジトリへのコントリビューションは、同梱の ISC ライセンスの下で公開されることに同意したものとみなします。
